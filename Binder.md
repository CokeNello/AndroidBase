
# Linux IO & MMap

#### 什么是用户模式和内核模式

  在计算机系统中，各种硬件资源是有限的，因此为了保证每一个进程都能安全的执行。处理器设有两种模式：“用户模式”与“内核模式”。一些容易发生安全问题的操作都被限制在只有内核模式下才可以执行，例如I/O操作，修改基址寄存器内容等。


#### 什么是系统调用

  连接用户模式和内核模式的接口称之为系统调用。


#### 系统调用的过程

  应用程序代码运行在用户模式下，当应用程序需要调用内核模式下的指令时，先向操作系统发送调用请求。操作系统收到请求后，执行系统调用接口，使处理器进入内核模式。当处理器处理完系统调用操作后，操作系统会让处理器返回用户模式，继续执行用户代码。


#### 什么是用户态和内核态

  处理器设有两种模式：“用户模式”与“内核模式”，当处理器工作在用户模式下的时候，此时就称为用户态；当处理工作在内核模式下，就称为内核态。


#### 什么是用户空间和内核空间

  进程的虚拟地址空间可分为两部分，内核空间和用户空间。内核空间中存放的是内核代码和数据，而进程的用户空间中存放的是用户程序的代码和数据。不管是内核空间还是用户空间，它们都处于虚拟空间中，都是对物理地址的映射。


#### 什么是进程隔离

  操作系统中，进程与进程的用户空间的内存和数据都是不共享的。这样做的目的，是为了避免进程间相互操作数据的现象发生，从而引起各自的安全问题。


#### 用户空间和内核空间怎么交互

  通过系统调用来交互

#### 不同进程的用户空间怎么交互

  通过 IPC

#### 什么是IPC

  IPC是进程间通信InterProcess Communication的缩写


#### Linux上常用的IPC方式

  Linux传统IPC通常的做法是消息发送方将要发送的数据存放在自己用户空间的内存缓存区中，通过系统调用从用户态进入内核态。然后内核程序在内核空间分配内存，开辟一块内核缓存区，调用 copy_from_user() 函数将数据从用户空间的内存缓存区拷贝到内核空间的内核缓存区中。同样的，接收方进程在接收数据时在自己的用户空间开辟一块内存缓存区，然后内核程序调用 copy_to_user() 函数将数据从内核缓存区拷贝到接收进程的内存缓存区。这样数据发送方进程和数据接收方进程就完成了一次数据传输，我们称完成了一次进程间通信。

  像Linux上的Socket、管道、消息队列，都是基于此模型，但是这种方式有很大的缺陷，性能不高，对于数据，需要拷贝两次。

  ![](https://secure2.wostatic.cn/static/srdg6yt84oGxzWCQvSpmDW/image.png?auth_key=1712622318-sKBBXx9FWXSp23Ww6aQE6d-0-d873d504bf41001449a4e031325b3495)

  
#### 什么是MMap

  mmap是一种内存映射文件的方法，即将一个文件或者其它对象映射到进程的地址空间，实现文件磁盘地址和进程虚拟地址空间中一段虚拟地址的一一对映关系。



#### 什么是 Binder？

  Binder 是Android上特有的跨进程通信方式。






